<!DOCTYPE html>
<html lang="zh-HK">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>排便日記 | Bowel Diary</title>
    <style>
        :root {
            --color-cream-50: rgba(252, 252, 249, 1);
            --color-cream-100: rgba(255, 255, 253, 1);
            --color-gray-200: rgba(245, 245, 245, 1);
            --color-slate-500: rgba(98, 108, 113, 1);
            --color-brown-600: rgba(94, 82, 64, 1);
            --color-charcoal-700: rgba(31, 33, 33, 1);
            --color-charcoal-800: rgba(38, 40, 40, 1);
            --color-slate-900: rgba(19, 52, 59, 1);
            --color-teal-500: rgba(33, 128, 141, 1);
            --color-teal-600: rgba(29, 116, 128, 1);
            --color-teal-700: rgba(26, 104, 115, 1);
            --color-red-500: rgba(192, 21, 47, 1);
            --color-brown-600-rgb: 94, 82, 64;
            --color-teal-500-rgb: 33, 128, 141;
            --color-background: var(--color-cream-50);
            --color-surface: var(--color-cream-100);
            --color-text: var(--color-slate-900);
            --color-text-secondary: var(--color-slate-500);
            --color-primary: var(--color-teal-500);
            --color-primary-hover: var(--color-teal-600);
            --color-primary-active: var(--color-teal-700);
            --color-secondary: rgba(var(--color-brown-600-rgb), 0.12);
            --color-border: rgba(var(--color-brown-600-rgb), 0.2);
            --color-btn-primary-text: var(--color-cream-50);
            --color-card-border: rgba(var(--color-brown-600-rgb), 0.12);
            --color-error: var(--color-red-500);
            --radius-base: 8px;
            --radius-lg: 12px;
            --space-8: 8px;
            --space-12: 12px;
            --space-16: 16px;
            --space-20: 20px;
            --space-24: 24px;
            --font-size-base: 14px;
            --font-size-lg: 16px;
            --font-size-xl: 18px;
            --font-size-2xl: 20px;
        }

        @media (prefers-color-scheme: dark) {
            :root {
                --color-gray-200: rgba(245, 245, 245, 1);
                --color-gray-300: rgba(167, 169, 169, 1);
                --color-gray-400: rgba(119, 124, 124, 1);
                --color-teal-300: rgba(50, 184, 198, 1);
                --color-teal-400: rgba(45, 166, 178, 1);
                --color-red-400: rgba(255, 84, 89, 1);
                --color-gray-400-rgb: 119, 124, 124;
                --color-background: var(--color-charcoal-700);
                --color-surface: var(--color-charcoal-800);
                --color-text: var(--color-gray-200);
                --color-text-secondary: rgba(167, 169, 169, 0.7);
                --color-primary: var(--color-teal-300);
                --color-primary-hover: var(--color-teal-400);
                --color-secondary: rgba(var(--color-gray-400-rgb), 0.15);
                --color-border: rgba(var(--color-gray-400-rgb), 0.3);
                --color-btn-primary-text: var(--color-slate-900);
                --color-card-border: rgba(var(--color-gray-400-rgb), 0.2);
                --color-error: var(--color-red-400);
            }
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'PingFang TC', 'Microsoft JhengHei', sans-serif;
            background: var(--color-background);
            color: var(--color-text);
            padding: var(--space-20);
            line-height: 1.6;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
        }

        h1 {
            font-size: var(--font-size-2xl);
            margin-bottom: var(--space-24);
            color: var(--color-text);
        }

        .card {
            background: var(--color-surface);
            border: 1px solid var(--color-card-border);
            border-radius: var(--radius-lg);
            padding: var(--space-24);
            margin-bottom: var(--space-20);
        }

        .form-group {
            margin-bottom: var(--space-16);
        }

        label {
            display: block;
            margin-bottom: var(--space-8);
            font-weight: 500;
            color: var(--color-text);
            font-size: var(--font-size-base);
        }

        input[type="date"],
        input[type="time"],
        select {
            width: 100%;
            padding: var(--space-12);
            border: 1px solid var(--color-border);
            border-radius: var(--radius-base);
            background: var(--color-surface);
            color: var(--color-text);
            font-size: var(--font-size-base);
            transition: border-color 0.2s;
        }

        input:focus,
        select:focus {
            outline: none;
            border-color: var(--color-primary);
        }

        .radio-group {
            display: flex;
            gap: var(--space-16);
            margin-top: var(--space-8);
        }

        .radio-option {
            display: flex;
            align-items: center;
            gap: var(--space-8);
        }

        .radio-option input[type="radio"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
            accent-color: var(--color-primary);
        }

        .radio-option label {
            margin: 0;
            cursor: pointer;
            font-weight: 400;
        }

        .btn {
            padding: var(--space-12) var(--space-24);
            border: none;
            border-radius: var(--radius-base);
            font-size: var(--font-size-base);
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn-primary {
            background: var(--color-primary);
            color: var(--color-btn-primary-text);
        }

        .btn-primary:hover {
            background: var(--color-primary-hover);
        }

        .btn-secondary {
            background: var(--color-secondary);
            color: var(--color-text);
            border: 1px solid var(--color-border);
        }

        .btn-secondary:hover {
            background: rgba(var(--color-brown-600-rgb), 0.2);
        }

        .btn-group {
            display: flex;
            gap: var(--space-12);
            margin-top: var(--space-20);
        }

        .records-section {
            margin-top: var(--space-24);
        }

        .records-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--space-16);
        }

        .records-header h2 {
            font-size: var(--font-size-xl);
            color: var(--color-text);
        }

        .record-item {
            background: var(--color-surface);
            border: 1px solid var(--color-card-border);
            border-radius: var(--radius-base);
            padding: var(--space-16);
            margin-bottom: var(--space-12);
            display: flex;
            justify-content: space-between;
            align-items: start;
        }

        .record-content {
            flex: 1;
        }

        .record-date {
            font-weight: 600;
            color: var(--color-primary);
            margin-bottom: var(--space-8);
        }

        .record-detail {
            display: grid;
            grid-template-columns: 120px 1fr;
            gap: var(--space-8);
            margin-bottom: var(--space-8);
            font-size: var(--font-size-base);
        }

        .record-label {
            color: var(--color-text-secondary);
        }

        .record-value {
            color: var(--color-text);
        }

        .btn-delete {
            background: var(--color-error);
            color: white;
            padding: var(--space-8) var(--space-16);
            font-size: 13px;
        }

        .btn-delete:hover {
            opacity: 0.9;
        }

        .empty-state {
            text-align: center;
            padding: var(--space-24);
            color: var(--color-text-secondary);
        }

        .incontinence-yes {
            color: var(--color-error);
            font-weight: 500;
        }

        .incontinence-no {
            color: var(--color-primary);
            font-weight: 500;
        }

        .bristol-info {
            background: var(--color-surface);
            border: 1px solid var(--color-card-border);
            border-radius: var(--radius-lg);
            padding: var(--space-16);
            margin-top: var(--space-12);
            margin-bottom: var(--space-16);
        }

        .bristol-info h3 {
            font-size: var(--font-size-base);
            margin-bottom: var(--space-12);
            color: var(--color-text);
        }

        .bristol-chart {
            display: grid;
            gap: var(--space-8);
        }

        .bristol-type {
            display: grid;
            grid-template-columns: 50px 1fr;
            gap: var(--space-12);
            padding: var(--space-8);
            background: var(--color-background);
            border-radius: var(--radius-base);
            align-items: center;
        }

        .bristol-number {
            font-weight: 600;
            color: var(--color-primary);
            text-align: center;
            font-size: var(--font-size-lg);
        }

        .bristol-desc {
            font-size: 13px;
            color: var(--color-text);
            line-height: 1.4;
        }

        .bristol-visual {
            text-align: center;
            font-size: 24px;
            line-height: 1;
        }

        @media (max-width: 600px) {
            body {
                padding: var(--space-12);
            }

            .card {
                padding: var(--space-16);
            }

            .btn-group {
                flex-direction: column;
            }

            .btn {
                width: 100%;
            }

            .record-detail {
                grid-template-columns: 100px 1fr;
                font-size: 13px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>排便日記 Bowel Diary</h1>

        <div class="card">
            <form id="diaryForm">
                <div class="form-group">
                    <label for="date">日期</label>
                    <input type="date" id="date" required>
                </div>

                <div class="form-group">
                    <label for="time">排便時間</label>
                    <input type="time" id="time" required>
                </div>

                <div class="form-group">
                    <label>失禁</label>
                    <div class="radio-group">
                        <div class="radio-option">
                            <input type="radio" id="incontinence-yes" name="incontinence" value="是" required>
                            <label for="incontinence-yes">是</label>
                        </div>
                        <div class="radio-option">
                            <input type="radio" id="incontinence-no" name="incontinence" value="否" required>
                            <label for="incontinence-no">否</label>
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <label for="leakage">大便滲漏或染色</label>
                    <select id="leakage" required>
                        <option value="">請選擇...</option>
                        <option value="無">無</option>
                        <option value="輕微滲漏">輕微滲漏</option>
                        <option value="中度滲漏">中度滲漏</option>
                        <option value="嚴重滲漏">嚴重滲漏</option>
                        <option value="衣物染色">衣物染色</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="bristol">Bristol Stool Score (布里斯托大便分類法)</label>
                    <select id="bristol" required>
                        <option value="">請選擇...</option>
                        <option value="第1型 - 分離硬塊">第1型 - 分離硬塊（如堅果）</option>
                        <option value="第2型 - 成條香腸狀但表面凹凸">第2型 - 成條香腸狀但表面凹凸</option>
                        <option value="第3型 - 如條狀香腸但表面有裂痕">第3型 - 如條狀香腸但表面有裂痕</option>
                        <option value="第4型 - 像條狀香腸或蛇平滑柔軟">第4型 - 像條狀香腸或蛇平滑柔軟</option>
                        <option value="第5型 - 柔軟塊狀清楚邊緣">第5型 - 柔軟塊狀清楚邊緣</option>
                        <option value="第6型 - 蓬鬆塊狀不成形">第6型 - 蓬鬆塊狀不成形</option>
                        <option value="第7型 - 水狀無固體">第7型 - 水狀無固體</option>
                    </select>
                    <div class="bristol-info">
                        <h3>布里斯托大便分類法參考圖</h3>
                        <div class="bristol-chart">
                            <div class="bristol-type">
                                <div class="bristol-number">第1型</div>
                                <div class="bristol-desc">分離硬塊，像堅果（難以排出）<br><img src="https://agi-prod-file-upload-public-main-use1.s3.amazonaws.com/dc8a026e-7734-4b21-a296-81bf9631e82b" alt="Type 1" style="max-width: 80px; height: auto; margin-top: 4px;"></div>
                            </div>
                            <div class="bristol-type">
                                <div class="bristol-number">第2型</div>
                                <div class="bristol-desc">成條香腸狀，但表面凹凸<br><img src="https://agi-prod-file-upload-public-main-use1.s3.amazonaws.com/a63932a7-0173-4f52-aca2-228e9b295bae" alt="Type 2" style="max-width: 100px; height: auto; margin-top: 4px;"></div>
                            </div>
                            <div class="bristol-type">
                                <div class="bristol-number">第3型</div>
                                <div class="bristol-desc">如條狀香腸，但表面有裂痕<br><img src="https://agi-prod-file-upload-public-main-use1.s3.amazonaws.com/3a900c6b-121f-497d-af16-a832993980e6" alt="Type 3" style="max-width: 80px; height: auto; margin-top: 4px;"></div>
                            </div>
                            <div class="bristol-type">
                                <div class="bristol-number">第4型</div>
                                <div class="bristol-desc">像條狀香腸或蛇，平滑柔軟（理想）<br><img src="https://agi-prod-file-upload-public-main-use1.s3.amazonaws.com/3253521f-b0ca-4a66-a264-5674c471f031" alt="Type 4" style="max-width: 100px; height: auto; margin-top: 4px;"></div>
                            </div>
                            <div class="bristol-type">
                                <div class="bristol-number">第5型</div>
                                <div class="bristol-desc">柔軟塊狀，清楚邊緣<br><img src="https://agi-prod-file-upload-public-main-use1.s3.amazonaws.com/92562a39-67c0-4e15-adca-9aaaa2db0994" alt="Type 5" style="max-width: 80px; height: auto; margin-top: 4px;"></div>
                            </div>
                            <div class="bristol-type">
                                <div class="bristol-number">第6型</div>
                                <div class="bristol-desc">蓬鬆塊狀，不成形<br><img src="https://agi-prod-file-upload-public-main-use1.s3.amazonaws.com/109c26fe-d29b-4d79-9533-1cdb76facf7b" alt="Type 6" style="max-width: 80px; height: auto; margin-top: 4px;"></div>
                            </div>
                            <div class="bristol-type">
                                <div class="bristol-number">第7型</div>
                                <div class="bristol-desc">水狀，無固體（腹瀉）<br><img src="https://agi-prod-file-upload-public-main-use1.s3.amazonaws.com/0dcadbd2-1591-45c3-bfdd-292b4e671cb2" alt="Type 7" style="max-width: 80px; height: auto; margin-top: 4px;"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <label>迫切性 (可以推遲15分鐘大便)</label>
                    <div class="radio-group">
                        <div class="radio-option">
                            <input type="radio" id="urgency-yes" name="urgency" value="是" required>
                            <label for="urgency-yes">是</label>
                        </div>
                        <div class="radio-option">
                            <input type="radio" id="urgency-no" name="urgency" value="否" required>
                            <label for="urgency-no">否</label>
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <label>尿片</label>
                    <div class="radio-group">
                        <div class="radio-option">
                            <input type="radio" id="diaper-yes" name="diaper" value="是" required>
                            <label for="diaper-yes">是</label>
                        </div>
                        <div class="radio-option">
                            <input type="radio" id="diaper-no" name="diaper" value="否" required>
                            <label for="diaper-no">否</label>
                        </div>
                    </div>
                </div>

                <div class="btn-group">
                    <button type="submit" class="btn btn-primary">新增記錄</button>
                    <button type="button" class="btn btn-secondary" id="exportBtn">匯出記錄</button>
                    <button type="button" class="btn btn-secondary" id="clearBtn">清除所有記錄</button>
                </div>
            </form>
        </div>

        <div class="records-section">
            <div class="records-header">
                <h2>記錄列表</h2>
            </div>
            <div id="recordsList">
                <div class="empty-state">暫無記錄</div>
            </div>
        </div>
    </div>

    <script>
        let records = [];

        function init() {
            const savedRecords = getRecords();
            if (savedRecords) {
                records = savedRecords;
                renderRecords();
            }

            const today = new Date().toISOString().split('T')[0];
            document.getElementById('date').value = today;
            
            const now = new Date();
            const hours = String(now.getHours()).padStart(2, '0');
            const minutes = String(now.getMinutes()).padStart(2, '0');
            document.getElementById('time').value = `${hours}:${minutes}`;
        }

        function getRecords() {
            const saved = getStoredRecords();
            return saved ? JSON.parse(saved) : [];
        }

        function saveRecords() {
            storeRecords(JSON.stringify(records));
        }

        function getStoredRecords() {
            try {
                if (typeof localStorage !== 'undefined') {
                    return localStorage.getItem('continenceDiaryRecords');
                }
                return window.recordsData || null;
            } catch (e) {
                return window.recordsData || null;
            }
        }

        function storeRecords(data) {
            try {
                if (typeof localStorage !== 'undefined') {
                    localStorage.setItem('continenceDiaryRecords', data);
                }
                window.recordsData = data;
            } catch (e) {
                window.recordsData = data;
            }
        }

        document.getElementById('diaryForm').addEventListener('submit', function(e) {
            e.preventDefault();

            const date = document.getElementById('date').value;
            const time = document.getElementById('time').value;
            const incontinence = document.querySelector('input[name="incontinence"]:checked').value;
            const leakage = document.getElementById('leakage').value;
            const bristol = document.getElementById('bristol').value;
            const urgency = document.querySelector('input[name="urgency"]:checked').value;
            const diaper = document.querySelector('input[name="diaper"]:checked').value;

            const record = {
                id: Date.now(),
                date,
                time,
                incontinence,
                leakage,
                bristol,
                urgency,
                diaper,
                timestamp: new Date().toISOString()
            };

            records.unshift(record);
            saveRecords();
            renderRecords();

            e.target.reset();
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('date').value = today;
            const now = new Date();
            const hours = String(now.getHours()).padStart(2, '0');
            const minutes = String(now.getMinutes()).padStart(2, '0');
            document.getElementById('time').value = `${hours}:${minutes}`;
        });

        function renderRecords() {
            const recordsList = document.getElementById('recordsList');

            if (records.length === 0) {
                recordsList.innerHTML = '<div class="empty-state">暫無記錄</div>';
                return;
            }

            const sortedRecords = [...records].sort((a, b) => {
                const dateA = new Date(a.date + ' ' + a.time);
                const dateB = new Date(b.date + ' ' + b.time);
                return dateB - dateA;
            });

            recordsList.innerHTML = sortedRecords.map(record => {
                const incontinenceClass = record.incontinence === '是' ? 'incontinence-yes' : 'incontinence-no';
                return `
                    <div class="record-item">
                        <div class="record-content">
                            <div class="record-date">${formatDate(record.date)}</div>
                            <div class="record-detail">
                                <span class="record-label">排便時間:</span>
                                <span class="record-value">${record.time}</span>
                            </div>
                            <div class="record-detail">
                                <span class="record-label">失禁:</span>
                                <span class="record-value ${incontinenceClass}">${record.incontinence}</span>
                            </div>
                            <div class="record-detail">
                                <span class="record-label">大便滲漏或染色:</span>
                                <span class="record-value">${record.leakage}</span>
                            </div>
                            <div class="record-detail">
                                <span class="record-label">Bristol Stool Score:</span>
                                <span class="record-value">${record.bristol}</span>
                            </div>
                            <div class="record-detail">
                                <span class="record-label">迫切性:</span>
                                <span class="record-value">${record.urgency}</span>
                            </div>
                            <div class="record-detail">
                                <span class="record-label">尿片:</span>
                                <span class="record-value">${record.diaper}</span>
                            </div>
                        </div>
                        <button class="btn btn-delete" onclick="deleteRecord(${record.id})">刪除</button>
                    </div>
                `;
            }).join('');
        }

        function formatDate(dateStr) {
            const date = new Date(dateStr);
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const day = String(date.getDate()).padStart(2, '0');
            const weekdays = ['星期日', '星期一', '星期二', '星期三', '星期四', '星期五', '星期六'];
            const weekday = weekdays[date.getDay()];
            return `${year}年${month}月${day}日 ${weekday}`;
        }

        function deleteRecord(id) {
            if (confirm('確定要刪除此記錄嗎？')) {
                records = records.filter(r => r.id !== id);
                saveRecords();
                renderRecords();
            }
        }

        document.getElementById('exportBtn').addEventListener('click', function() {
            if (records.length === 0) {
                alert('暫無記錄可匯出');
                return;
            }

            const sortedRecords = [...records].sort((a, b) => {
                const dateA = new Date(a.date + ' ' + a.time);
                const dateB = new Date(b.date + ' ' + b.time);
                return dateB - dateA;
            });

            const csvContent = [
                '日期,排便時間,失禁,大便滲漏或染色,Bristol Stool Score,迫切性,尿片',
                ...sortedRecords.map(r => `${r.date},${r.time},${r.incontinence},${r.leakage},${r.bristol},${r.urgency},${r.diaper}`)
            ].join('\n');

            const BOM = '\uFEFF';
            const blob = new Blob([BOM + csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            const filename = `排便日記_${new Date().toISOString().split('T')[0]}.csv`;

            link.setAttribute('href', url);
            link.setAttribute('download', filename);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        });

        document.getElementById('clearBtn').addEventListener('click', function() {
            if (confirm('確定要清除所有記錄嗎？此操作無法復原。')) {
                if (confirm('再次確認：所有記錄將被永久刪除！')) {
                    records = [];
                    saveRecords();
                    renderRecords();
                    alert('所有記錄已清除');
                }
            }
        });

        init();
    </script>
</body>
</html>

